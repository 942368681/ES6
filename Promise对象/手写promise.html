<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

</body>
<script>
    class MyPromise {
        constructor(executor) {
            this.state = 'PENDING';
            this.value = undefined;
            this.reason = undefined;
            this.onResolvedCallbacks = [];
            this.onRejectedCallbacks = [];

            const resolve = (value) => {
                if (this.state === 'PENDING') {
                    this.state = 'FULFILLED';
                    this.value = value;
                    this.onResolvedCallbacks.forEach(fn => fn());
                }
            };
            const reject = (reason) => {
                if (this.state === 'PENDING') {
                    this.state = 'REJECTED';
                    this.reason = reason;
                    this.onRejectedCallbacks.forEach(fn => fn());
                }
            };

            try {
                executor(resolve, reject);
            } catch (error) {
                reject(error);
            }
        };

        then(onFulfilled, onRejected) {
            if (this.state === 'FULFILLED') {
                onFulfilled(this.value);
            }
            if (this.state === 'REJECTED') {
                onRejected(this.reason);
            }
            if (this.state === 'PENDING') {
                this.onResolvedCallbacks.push(() => onFulfilled(this.value));
                this.onRejectedCallbacks.push(() => onRejected(this.reason));
            }
        };
    };

    const promise = new MyPromise((resolve, reject) => {
        // resolve('成功');
        setTimeout(() => {
            resolve('成功');
        }, 1000);
    }).then(
        (data) => {
            console.log('success', data)
        },
        (err) => {
            console.log('faild', err)
        }
    )
</script>

</html>